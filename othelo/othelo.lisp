;;constants to be used
;;--------------------------------------------------------------------------
;; empty squares
(defconstant empty 0 )

;; black pieces
(defconstant black 1 )

;; white pieces
(defconstant white 2 )

;; squares out of the board limit
(defconstant edges 3 )

;;values to calculate next square 
;; -1 = up 1 = down
;; -10 = left 10 = right
;; -11 = diagonal left up 11 = diagonal right down
;; -9 = diagonal left down 9 = diagonal right up


(defconstant directions '(-11 -10 -9 -1 1 9 10 11))
(defvar *move-number* 1 "The number of the move to be played")


;;---------------------------------------------------------------------------------------------

;;some definitions

;;define board heuristic number for ai moves
(defparameter *weights*
  '#(0   0   0  0  0  0  0   0   0 0
     0 120 -20 20  5  5 20 -20 120 0
     0 -20 -40 -5 -5 -5 -5 -40 -20 0
     0  20  -5 15  3  3 15  -5  20 0
     0   5  -5  3  3  3  3  -5   5 0
     0   5  -5  3  3  3  3  -5   5 0
     0  20  -5 15  3  3 15  -5  20 0
     0 -20 -40 -5 -5 -5 -5 -40 -20 0
     0 120 -20 20  5  5 20 -20 120 0
     0   0   0  0  0  0  0   0   0 0))

;;define the simbol for a piece
(defun piece_simbol (piece) (char ".BW?" piece))

;;type definitions
(deftype piece () `(integer ,empty ,edges))
(deftype board () '(simple-array piece (100)))


;; oponent color definition
(defun opponent (player) (if (eql player black) white black))

;;define all playble isqueres of the board
(defconstant in-board-squares
  (loop for i from 11 to 88 when (<= 1 (mod i 10) 8) collect i))

;; define setf behavior
(defsetf bref (board square) (val) 
  `(setf (aref ,board ,square) ,val))



;;-------------------------------------------------------------------------------

(defun concatenate-symbol (&rest args)
  (intern (format nil "狺狎珞┅ㄤ彐躅磲痧孱ㄦ蝈篝祗趔㈨狃屐屙孱趔轭扉篝犷骈钺祆狃疱钿犰蝈篚祠邃扉篝螽ㄡ痧禊＇狃疱钿ㄡ痧禊＇磲疸狎骖祗趔┅换吁镦翳麇殓梏镦痨狴弪篑踽蝈黹铛镳痫铄铘ㄤ彐躅麇殓梏邃篑踽蝈痨狴弪怙狎洎戾è镳镳痫铄铘痨狴弪┅祜镳骘轭轭怙狎洵篑踽蝈麒孱ㄥ耢ㄢ蝈怙狎椹痨狴弪篚ㄡ蝈麇殓梏螵椹麒孱ㄥ耢ㄢ蝈怙狎椹镳皓篚ōㄡ蝈麇殓梏螵椹┅┅换箦痖邈麸翳泔蝌弩痫钿孱篑踽蝈镦翳怙狎ㄤ彐躅怛彐ㄢ镝蜾篑踽蝈ㄡ蝈怙狎篑踽蝈┅换泸遽翦翳怙狎犷痨徙翳轭轸獒痖邈弩ㄤ彐躅篝狎暨怙狎ī戾è怙狎磲脲狎蜥卑哄戾礤铘豉疱ю殄沐洪铋糸犰屐屙孱邃珏螬┅ㄤ镬轶篑踽蝈轭怙狎洵篑踽蝈螬箦翩ㄢ蝈怙狎篑踽蝈屙痿┅箦翩ㄢ蝈怙狎创麒轸ㄢ蝈怙狎吹忪徙ㄢ蝈怙狎荡忪徙ㄢ蝈怙狎档麒轸濠怙狎洎换溴骈铄翳鲠蜷徕戾怙狎洫鏖翳翳轭轸獒怙狎ㄤ彐鲠怙狎洫篝狎暨怙狎洎ㄤ彐躅痱轭舡怙狎é镳糸镱犰ㄢ镝蜾怙狎洫┅换崎蝮痱轭翳桢徜弪犷翳沲蝌孱筱矧ㄦ矧磲拨埝憬册憬册冷┹痖邈暹箝礅镬忪徙氅ㄣ秕铘忪徙怙狎洎痖邈暹箝礅镬麒轸濠ㄣ秕铘麒轸怙狎洎ㄣ秕铘溟骀弪孱沐忪徙怙狎洎换痱轭扉铄铛礅弪犷翳扉铄祜镳骘扉铄骝镯麸滹ㄦ矧磲扉铄祜镳骘泔祯铄骝镯麸骘痖邈ㄢ蝈怙狎ǐ泔祯铄í卑扉铄┅滹ㄦ矧磲痖邈暹箝礅镬痖邈濠┅┅ㄤ彐躅泔躅舡溟骀弪孱沐痨狴弪怙狎洎ōㄣ秕铘痨狴弪怙狎洎ㄣ秕铘镳痫铄铘痨狴弪怙狎洎┅换牾篝蝈趱蝾殒翳盹鲥轶轭箝溴镦翳怙狎ㄤ彐躅鲠扉洵痨徙盹鲥ㄡ钿ㄩ铘彗弪盹鲥冀北盹鲥父冀盹盹鲥卑俯┅换蝈趱蝾殒盹鲥轶戾玑ㄤ彐躅戾玑飙痨徙盹鲥痨狴弪怙狎洎ㄡ钿ㄥ耢ㄢ蝈怙狎盹鲥屙痿箫礤＇灬礅溽ㄤ轵ㄤ镥筮骒轲盹鲥痨狴弪怙狎溟颟溟蝈泗轱铙┅换蝈趱蝾殒盹鲥骒轲犷痖邈ㄤ彐躅滹弩哝扉盹鲥痨狴弪怙狎溟颟戾èǐ盹鲥溟颟┅ㄡ钿ㄥ耢ㄢ蝈怙狎悌镳痫铄铘痨狴弪┅ㄦ轭洵怛徙脲糸铉痖邈ǐ溟颟痨狴弪怙狎溟颟┅换骈钿铄痖邈骘玳鲥溟蝈泗轱ㄤ彐躅骈钿怛徙脲糸铉痖邈篑踽蝈痨狴弪怙狎溟颟ㄣ镱è羼ㄢ蝈怙狎篑踽蝈痨狴弪篑踽蝈è羼ㄢ蝈怙狎篑踽蝈镳痫铄铘痨狴弪┅ㄦ轭洵怛徙脲糸铉痖邈ǐ篑踽蝈溟颟痨狴弪怙狎溟颟铋飑┅换蝈趱蝾怙镬遽殒痨狴弪栳盹鲥ㄤ彐躅栳鲥唔秭弩痨狴弪怙狎洎箫礤＇灬礅溽盹鲥戾玑飙痨徙盹鲥痨狴弪怙狎洎轭怙狎洵篑踽蝈螬换蝈趱蝾犰痫篌殁戾盹鲥骘玳鲥痨狴弪ㄤ彐躅痫篌殁戾盹鲥痨狴弪怙狎洎祜镳骘盹鲥轭轭怙狎洵篑踽蝈麒孱戾玑飙痨徙盹鲥痨狴弪怙狎洎泔祆邈盹鲥┅换滹翳汨犷珏镱翳翎忪徭翦盹鲥ㄤ彐躅憝盹鲥盹鲥痨狴弪怙狎洎箦翩ㄢ蝈怙狎盹鲥痨狴弪ㄤ镬轶ㄤ轵溟蝈泗轱铙憝骒轲盹鲥痨狴弪怙狎溟颟怙狎洎换骒轲翳痖邈弩徭翦盹鲥ㄤ彐躅憝骒轲盹鲥痨狴弪怙狎溟颟戾è怛徙脲翦ㄤ镥筮骒轲盹鲥痨狴弪怙狎溟颟┅麒孱怛徙脲翦ㄩ铒舁羼盹鲥怛徙脲翦颟痱镧箦翩ㄢ蝈怙狎ǐ盹鲥溟颟痨狴弪憝骒轲ǐ盹鲥溟颟痨狴弪怙狎溟颟铋┅┅ㄤ彐躅箦戾泗篝蜥翦琦痨狴弪痱轭ㄦ矧磲汨矬翳篝蜥翦琦骘翳日土伊文贤撂腥镰屡粤痨狴弪┅篝蜥翦琦汨镩沐蝈徜痨狴弪┅ㄤ彐躅篝蜥翦琦汨镩沐ㄣ栾殂痨狴弪ㄩ汨镩沐暴痱轭ㄦ矧磲Ⅸ秕汨矬邃日土骘翳痨狴弪幄痨狴弪┅ㄩ汨镩沐博痱轭ㄦ矧磲Ⅸ秕汨矬邃伊文贤骘翳痨狴弪幄痨狴弪┅ㄩ汨镩沐畅痱轭ㄦ矧磲Ⅸ秕汨矬邃撂腥镰屡粤骘翳痨狴弪幄痨狴弪┅痱轭Ⅶ蝻铉汨镩沐痨遽箦趄徵衢┅┅ㄤ彐躅汨镩沐ㄣ栾殂濠痱轭汨镩沐ㄩ汨镩沐暴痱镧痱轭Ⅸ秕汨矬邃绿撩刷舂ㄩ汨镩沐博痱镧痱轭Ⅸ秕汨镲箦兹稍泞舂痱镧痱轭Ⅶ蝻铉汨镩沐痨遽箦趄徵衢绿撩兹稍骄铋飑┅ㄤ彐躅雉桢祆ī戾舄è怙狎篝狎暨怙狎洎┅ㄣ狒汨х犴瀛秭弪祜镳骘盹鲥铛礅弪骝镯骘痨狴弪忪徙翳孱铄舡麸痨狴怙狎痨狴弪舂骘篝蜥翦琦＇桴磲躅糸铛祆痨狴弪滹ㄧ弭盹鲥篝蜥翦琦痨狴弪怙狎洎麒孱ㄦ矧磲υ桢玑礤轶秭弪崎钺蝈篚祠孩痱轭舡怙狎怙狎洎┅┅ㄤ彐躅铄舡麸痨狴ㄢ镝蜾痱弼轱躞痨狴弪痱轭舂⒚镯瘐翦翳痨狴弪麸盹鲥铄衄矧紊殒铒怙澌汜盹鲥戾è镳镳痫铄铘痱弼轱躞痨狴弪┅ㄣ镱è栳鲥唔秭弩镳怙狎洎镳皓è栳鲥唔秭弩痱弼轱躞痨狴弪怙狎洎麒孱痱轭ㄦ矧磲栳铒盹鲥犷眭篝疳篌痖邈暹箝礅镬镳皓┅痱弼轱躞痨狴弪铋飑┅ㄤ彐躅珏舡盹鲥篝蜥翦琦痨狴弪怙狎洎麒孱痱轭舡怙狎怙狎洎戾舄è盹鲥ㄦ躅汜祆篝蜥翦琦痨狴弪蝈痨徙怙狎洫怙狎洎┅ㄣ镱è羼盹鲥蝈箝珙翳蝻х犴瀛秭弪ㄩㄥ耢痨狴弪忪徙氅洞洞┅è犷鲠扉洵痨徙盹鲥戾玑飙痨徙盹鲥痨狴弪怙狎洎ㄦ矧磲盹鲥麸岙痖邈暹箝礅镬痨狴弪ǜ腑捐盹鲥┅憝盹鲥盹鲥痨狴弪怙狎洎┅┅ㄤ彐躅泸矬蟓痱镤蹉ㄦ扉篝扉篝⒁弭躜扉篝镦犰ㄦ鲠祯弩磲痧孱＇灬礅溽磲疸狎＇灬礅溽ㄦ躅汜祆骖┅扉篝┅扉篝┅换钺礤镦遽汨痨徙镱翳怙狎戾è篑踽蝈钺礤ㄣ蝻篌痱镤蹉＇泔钽狒孱狒瀛簌礅镬Ж咯Ж咯┅ㄤ彐躅韪靖篝颟⒚镱鲥螋骝镯犰痂犷蹴弪殂麸铛礤蜷篑踽蝈铒翎糸镱矧痫箝糸镱篝蜷铉篝颟篑踽蝈钺礤呼弩＇篝蜷铉羼踽飑篝颟ㄤ彐躅父捐铛愆⒚镱鲥螋骝镯铛礤蜷麸犰痂犷蹴弪殂篑踽蝈铒翎糸镱ㄩ鲠扉洵痨徙铛愆ㄥ祠篑踽蝈钺礤铛愆铛愆┅ㄤ彐躅桴磲痨狴弪怙狎洎ㄦ矧磲麸盹鲥岷痖邈暹箝礅镬痨狴弪磲疸狎＇父捐痫篌殁戾盹鲥痨狴弪怙狎洎┅ㄨ腑靖蝈徜┅